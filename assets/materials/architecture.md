[Вернуться][main]

---

# Архитектура

Apache Kafka построена на концепциях брокеров, топиков, партиций и офсетов.

## Брокеры

Брокеры являются основным компонентом в архитектуре Kafka. Фактически, брокеры – это самостоятельные сервера, работающие
в составе Kafka-кластера. Каждый брокер уникален и идентифицируется своим ID.

Брокеры хранят определенное количество топиков и сообщений. Все сообщения в Kafka сохраняются на диске и снабжаются
временными метками, которые указывают время жизни сообщения на брокере.

## Топики

Топик в Kafka - это набор сообщений одного типа. Топики играют важную роль в процессе категоризации потоков данных.
Производители пишут данные в конкретные топики, а потребители читают данные из этих топиков.

## Партиции

Для обеспечения масштабируемости и отказоустойчивости каждый топик в Kafka делится на партиции. Каждая партиция — это
упорядоченный, неизменяемый набор сообщений, которые непрерывно добавляются к структуре данных называемой `commit log`.
Внутри партиции сообщения идентифицируются их офсетом.

Партиции также позволяют распределить данные топика по всему кластеру, так как каждая партиция может быть на отдельном
сервере.

## Офсеты

Офсеты в Kafka — это уникальный идентификатор каждого сообщения внутри партиции.

Офсет обеспечивает возможность знать позицию каждого сообщения в потоке данных. Это представляет собой длинное целое
число, которое непрерывно увеличивается с каждым новым сообщением в партиции.

Офсеты позволяют потребителям знать, какие сообщения они уже прочитали и какие еще осталось прочитать. Когда потребитель
читает сообщение, он также получает информацию об офсете. Если потребитель падает и затем восстанавливается, он может
продолжать чтение сообщений с последнего известного офсета.

## Заключение

Вышеописанные контролирующие концепции критически важны для понимания того, как Kafka обрабатывает и управляет
большими объёмами потока данных. Обеспечение масштабируемости, устойчивости к отказам и производительности являются
ключевыми факторами, делающими Kafka столь мощным инструментом для бизнеса.

В заключение нужно упомянуть об ещё одном важном компоненте кластера Kafka — Apache ZooKeeper.

ZooKeeper выполняет роль консистентного хранилища метаданных и распределённого сервиса логов. Именно он способен
сказать, живы ли ваши брокеры, какой из брокеров является контроллером (то есть брокером, отвечающим за выбор лидеров
партиций), и в каком состоянии находятся лидеры партиций и их реплики.

В случае падения брокера именно в ZooKeeper контроллером будет записана информация о новых лидерах партиций. Причём с
версии 1.1.0 - асинхронно, и это важно с точки зрения скорости восстановления кластера. Самый простой способ превратить
данные в тыкву — потеря информации в ZooKeeper. Тогда понять, что и откуда нужно читать, будет очень
сложно.

Важно помнить, что ZooKeeper по факту является ещё одной распределённой системой хранения данных, за которой необходимо
следить, поддерживать и обновлять по мере необходимости.

Традиционно ZooKeeper раскатывается отдельно от брокеров Kafka, чтобы разделить границы возможных отказов. Помните, что
падение ZooKeeper — это практически падение всего кластера Kafka. К счастью, нагрузка на ZooKeeper при нормальной работе
кластера минимальна. Клиенты Kafka никогда не коннектятся к ZooKeeper напрямую.

---

[Вернуться][main]


[main]: ../../README.md "содержание"
